<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GMS - Politie Meldkamer Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border-left: 5px solid #2a5298;
        }

        .section h2 {
            color: #2a5298;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notepad {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-family: 'Segoe UI', sans-serif;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
            background: white;
            transition: border-color 0.3s ease;
        }

        .notepad:focus {
            outline: none;
            border-color: #2a5298;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: #2a5298;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.1);
        }

        .priority-input {
            max-width: 100px;
        }

        .priority-display {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .priority-emoji {
            font-size: 1.5em;
        }

        .priority-text {
            font-weight: 600;
            padding: 5px 10px;
            border-radius: 15px;
            color: white;
            font-size: 12px;
            text-transform: uppercase;
        }

        .save-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .save-btn:active {
            transform: translateY(0);
        }

        .result-section {
            grid-column: 1 / -1;
            margin-top: 20px;
        }

        .json-output {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.4;
            overflow-x: auto;
            white-space: pre-wrap;
            border: 2px solid #4a5568;
        }

        .json-output:empty {
            color: #a0aec0;
        }

        .json-output:empty::before {
            content: "Vul het formulier in en klik op 'Melding opslaan' om de JSON-output te zien...";
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }

        .timestamp {
            color: #6c757d;
            font-size: 12px;
            margin-top: 5px;
        }

        /* Custom scrollbar */
        .notepad::-webkit-scrollbar {
            width: 8px;
        }

        .notepad::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .notepad::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        .notepad::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöî GMS</h1>
            <p>Politie Meldkamer Simulator</p>
        </div>

        <div class="main-content">
            <div class="section">
                <h2>üìù Vrije Notitie</h2>
                <textarea id="notepad" class="notepad" placeholder="Typ hier een beschrijving van het incident..."></textarea>
                <div class="timestamp" id="notepadTimestamp"></div>
            </div>

            <div class="section">
                <h2>üìã Aanname Scherm</h2>
                <form id="incidentForm">
                    <div class="form-group">
                        <label for="location">üìç Locatie</label>
                        <input type="text" id="location" class="form-control" placeholder="Voer de locatie in..." required>
                    </div>

                    <div class="form-group">
                        <label for="time">‚è∞ Tijdstip</label>
                        <input type="datetime-local" id="time" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label for="incidentType">üö® Soort Melding</label>
                        <select id="incidentType" class="form-control" required>
                            <option value="">Selecteer soort melding...</option>
                            <option value="Inbraak woning">üè† Inbraak woning</option>
                            <option value="Brandmelding">üî• Brandmelding</option>
                            <option value="Verkeersongeval">üöó Verkeersongeval</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="priority">‚ö° Prioriteit (1-5)</label>
                        <input type="number" id="priority" class="form-control priority-input" min="1" max="5" value="3" required>
                        <div class="priority-display" id="priorityDisplay">
                            <span class="priority-emoji">‚ö†Ô∏è</span>
                            <span class="priority-text">Gemiddeld</span>
                        </div>
                    </div>

                    <button type="submit" class="save-btn">üíæ Melding Opslaan</button>
                </form>
            </div>

            <div class="section result-section">
                <h2>üìä Incident Object (JSON)</h2>
                <pre id="jsonOutput" class="json-output"></pre>
            </div>

            <div class="section result-section">
                <h2>üìã Opgeslagen Meldingen</h2>
                <div id="incidentsList" style="max-height: 400px; overflow-y: auto;"></div>
            </div>
        </div>
    </div>

    <script>
        // Initialize current time
        function initializeTime() {
            const now = new Date();
            const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            document.getElementById('time').value = localDateTime;
        }

        // Update priority display
        function updatePriorityDisplay() {
            const priority = parseInt(document.getElementById('priority').value);
            const priorityDisplay = document.getElementById('priorityDisplay');
            const emoji = priorityDisplay.querySelector('.priority-emoji');
            const text = priorityDisplay.querySelector('.priority-text');

            const priorities = {
                1: { emoji: 'üü¢', text: 'Zeer Laag', color: '#28a745' },
                2: { emoji: 'üü°', text: 'Laag', color: '#ffc107' },
                3: { emoji: '‚ö†Ô∏è', text: 'Gemiddeld', color: '#fd7e14' },
                4: { emoji: 'üî¥', text: 'Hoog', color: '#dc3545' },
                5: { emoji: 'üö®', text: 'Zeer Hoog', color: '#6f42c1' }
            };

            const priorityData = priorities[priority] || priorities[3];
            emoji.textContent = priorityData.emoji;
            text.textContent = priorityData.text;
            text.style.backgroundColor = priorityData.color;
        }

        // Update notepad timestamp
        function updateNotepadTimestamp() {
            const timestamp = document.getElementById('notepadTimestamp');
            const now = new Date();
            timestamp.textContent = `Laatst bijgewerkt: ${now.toLocaleString('nl-NL')}`;
        }

        // Handle form submission
        async function handleFormSubmit(event) {
            event.preventDefault();
            
            const saveBtn = document.querySelector('.save-btn');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '‚è≥ Opslaan...';
            saveBtn.disabled = true;
            
            const formData = {
                vrijeLnotitie: document.getElementById('notepad').value.trim(),
                locatie: document.getElementById('location').value.trim(),
                tijdstip: document.getElementById('time').value,
                soortMelding: document.getElementById('incidentType').value,
                prioriteit: parseInt(document.getElementById('priority').value),
                status: 'Nieuw'
            };

            try {
                const response = await fetch('/api/gms-incidents', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    throw new Error('Failed to save incident');
                }

                const savedIncident = await response.json();
                
                // Display JSON output
                const jsonOutput = document.getElementById('jsonOutput');
                jsonOutput.textContent = JSON.stringify(savedIncident, null, 2);
                
                // Show success message
                saveBtn.innerHTML = '‚úÖ Melding Opgeslagen!';
                saveBtn.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
                
                // Reset form
                document.getElementById('incidentForm').reset();
                document.getElementById('notepad').value = '';
                initializeTime();
                updatePriorityDisplay();
                updateNotepadTimestamp();
                
                // Load and display all incidents
                loadAllIncidents();
                
            } catch (error) {
                console.error('Error saving incident:', error);
                saveBtn.innerHTML = '‚ùå Fout bij opslaan';
                saveBtn.style.background = 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)';
            } finally {
                setTimeout(() => {
                    saveBtn.innerHTML = originalText;
                    saveBtn.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
                    saveBtn.disabled = false;
                }, 2000);
            }
        }

        // Load all incidents from database
        async function loadAllIncidents() {
            try {
                const response = await fetch('/api/gms-incidents');
                if (!response.ok) {
                    throw new Error('Failed to load incidents');
                }
                
                const incidents = await response.json();
                displayIncidentsList(incidents);
            } catch (error) {
                console.error('Error loading incidents:', error);
            }
        }

        // Display incidents list
        function displayIncidentsList(incidents) {
            const incidentsList = document.getElementById('incidentsList');
            if (!incidentsList) return;
            
            if (incidents.length === 0) {
                incidentsList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Geen meldingen gevonden</p>';
                return;
            }
            
            incidentsList.innerHTML = incidents.map(incident => {
                const priorityData = getPriorityData(incident.prioriteit);
                const formatTime = (dateString) => {
                    return new Date(dateString).toLocaleString('nl-NL');
                };
                
                return `
                    <div class="incident-item" style="border: 1px solid #e9ecef; margin-bottom: 10px; padding: 15px; border-radius: 8px; background: white;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <div>
                                <strong style="color: #2a5298;">${incident.soortMelding}</strong>
                                <span style="margin-left: 10px; padding: 3px 8px; border-radius: 12px; font-size: 11px; color: white; background: ${priorityData.color};">
                                    ${priorityData.emoji} ${priorityData.text}
                                </span>
                            </div>
                            <small style="color: #666;">#${incident.id}</small>
                        </div>
                        <div style="margin-bottom: 8px;"><strong>Locatie:</strong> ${incident.locatie}</div>
                        <div style="margin-bottom: 8px;"><strong>Tijdstip:</strong> ${formatTime(incident.tijdstip)}</div>
                        <div style="margin-bottom: 8px;"><strong>Status:</strong> ${incident.status}</div>
                        <div style="margin-bottom: 8px;"><strong>Aangemaakt:</strong> ${formatTime(incident.aangemaaktOp)}</div>
                        <div><strong>Notitie:</strong> ${incident.vrijeLnotitie}</div>
                    </div>
                `;
            }).join('');
        }

        // Get priority display data
        function getPriorityData(priority) {
            const priorities = {
                1: { emoji: 'üü¢', text: 'Zeer Laag', color: '#28a745' },
                2: { emoji: 'üü°', text: 'Laag', color: '#ffc107' },
                3: { emoji: '‚ö†Ô∏è', text: 'Gemiddeld', color: '#fd7e14' },
                4: { emoji: 'üî¥', text: 'Hoog', color: '#dc3545' },
                5: { emoji: 'üö®', text: 'Zeer Hoog', color: '#6f42c1' }
            };
            return priorities[priority] || priorities[3];
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            initializeTime();
            updatePriorityDisplay();
            updateNotepadTimestamp();
            loadAllIncidents(); // Load incidents on page load

            // Form submission
            document.getElementById('incidentForm').addEventListener('submit', handleFormSubmit);

            // Priority change
            document.getElementById('priority').addEventListener('input', updatePriorityDisplay);

            // Notepad change
            document.getElementById('notepad').addEventListener('input', updateNotepadTimestamp);

            // Auto-update time every minute
            setInterval(initializeTime, 60000);
            
            // Auto-refresh incidents every 30 seconds
            setInterval(loadAllIncidents, 30000);
        });
    </script>
</body>
</html>